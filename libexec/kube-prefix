#!/usr/bin/env bash
# Summary: Display prefix for a minikube machine
# Usage: kube prefix [<machine>]
#
# Displays the directory where a minikube machine is installed. If no
# machine is given, `kube prefix' displays the location of the
# currently selected machine.

set -e
[ -n "$KUBE_DEBUG" ] && set -x

# Provide kube completions
if [ "$1" = "--complete" ]; then
  echo system
  exec kube-machines --bare
fi

if [ -n "$1" ]; then
  export KUBE_MACHINE="$1"
elif [ -z "$KUBE_MACHINE" ]; then
  KUBE_MACHINE="$(kube-machine-name)"
fi

#if [ "$KUBE_MACHINE" = "system" ]; then
#  NODE_PATH="$(kube-which node)"
#  NODE_PATH="${NODE_PATH%/*}"
#  echo "${NODE_PATH%/bin}"
#  exit
#fi

KUBE_PREFIX_PATH="${KUBE_ROOT}/machines/${KUBE_MACHINE}"
if [ ! -d "$KUBE_PREFIX_PATH" ]; then
  echo "kube: machine \`${KUBE_MACHINE}' not installed" >&2
  exit 1
fi

echo "$KUBE_PREFIX_PATH"
